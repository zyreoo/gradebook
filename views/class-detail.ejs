<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class <%= classYear %> - Online Gradebook</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">  
            <h1>Class <%= classYear %></h1>
            <div class="user-info">
                <p><strong>Name:</strong> <%= user.name %></p>
                <p><strong>Email:</strong> <%= user.email %></p>
                <% if (isClassmaster) { %>
                    <p><strong style="color: var(--accent);">Classmaster</strong></p>
                <% } %>
            </div>
        </div>

        <% if (typeof error !== 'undefined' && error) { %>
            <div class="error-message">
                <%= error %>
            </div>
        <% } %>
        
        <% if (typeof success !== 'undefined' && success) { %>
            <div class="success-message">
                <%= success %>
            </div>
        <% } %>
        
        <div class="navigation">
            <a href="/dashboard">‚Üê Back to Dashboard</a>
        </div>

        <div class="section">
            <% 
                const teacherSubjects = teacher.subjects || (teacher.subject ? [teacher.subject] : []);
            %>
            
            <% if (students.length === 0) { %>
                <div class="empty-state">
                    <p>No students found in this class yet.</p>
                </div>
            <% } else if (teacherSubjects.length === 0) { %>
                <div class="empty-state">
                    <p>No subjects assigned. Contact your administrator.</p>
                </div>
            <% } else { %>
                <!-- Subject Tabs (if multiple subjects) -->
                <% if (teacherSubjects.length > 1) { %>
                    <div class="subject-tabs">
                        <% teacherSubjects.forEach(function(subject, index) { %>
                            <div class="subject-tab <%= index === 0 ? 'active' : '' %>" 
                                 onclick="switchSubject('<%= subject %>')">
                                <%= subject %>
                            </div>
                        <% }); %>
                    </div>
                <% } %>

                <!-- Subject Content -->
                <% teacherSubjects.forEach(function(subject, subjectIndex) { %>
                    <div class="subject-content <%= subjectIndex === 0 ? 'active' : '' %>" 
                         data-subject="<%= subject %>">
                        
                        <% if (teacherSubjects.length === 1) { %>
                            <h2><%= subject %></h2>
                        <% } %>

                        <!-- View Tabs: Overview, Grades, Absences -->
                        <div class="view-tabs">
                            <div class="view-tab active" onclick="switchView('<%= subject %>', 'overview')">
                                üìä Overview
                            </div>
                            <div class="view-tab" onclick="switchView('<%= subject %>', 'grades')">
                                üìù Add Grades
                            </div>
                            <div class="view-tab" onclick="switchView('<%= subject %>', 'absences')">
                                üìÖ Take Attendance
                            </div>
                        </div>

                        <!-- OVERVIEW VIEW -->
                        <div class="view-content active" data-view="overview" data-subject="<%= subject %>">
                            <h3>All Students - <%= subject %></h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Grades</th>
                                        <th>Recent Absences</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% students.forEach(function(student) { 
                                        const allGrades = student.allGrades || [];
                                        const allAbsences = student.allAbsences || [];
                                        const subjectGrades = allGrades.filter(g => g.subject === subject);
                                        const subjectAbsences = allAbsences.filter(a => a.subject === subject);
                                    %>
                                        <tr>
                                            <td><%= student.name %></td>
                                            <td><%= student.email %></td>
                                            <td>
                                                <% if (subjectGrades.length > 0) { %>
                                                    <% subjectGrades.slice(0, 8).forEach(function(grade) { %>
                                                        <span class="grade-badge"><%= grade.grade %></span>
                                                    <% }); %>
                                                    <% if (subjectGrades.length > 8) { %>
                                                        <span class="helper">+<%= subjectGrades.length - 8 %></span>
                                                    <% } %>
                                                    <br>
                                                    <small style="color: var(--text-dim);">
                                                        Average: <%= (subjectGrades.reduce((sum, g) => sum + g.grade, 0) / subjectGrades.length).toFixed(2) %>
                                                    </small>
                                                <% } else { %>
                                                    <span class="helper">No grades yet</span>
                                                <% } %>
                                            </td>
                                            <td>
                                                <% if (subjectAbsences.length > 0) { %>
                                                    <% subjectAbsences.slice(0, 3).forEach(function(absence) { 
                                                        let dateStr = '';
                                                        if (absence.date && absence.date.toDate) {
                                                            dateStr = absence.date.toDate().toLocaleDateString();
                                                        } else if (absence.date) {
                                                            dateStr = new Date(absence.date).toLocaleDateString();
                                                        }
                                                    %>
                                                        <span class="absence-badge <%= absence.type === 'motivated' ? 'motivated' : 'unmotivated' %>">
                                                            <%= dateStr %>
                                                        </span>
                                                    <% }); %>
                                                    <% if (subjectAbsences.length > 3) { %>
                                                        <span class="helper">+<%= subjectAbsences.length - 3 %></span>
                                                    <% } %>
                                                <% } else { %>
                                                    <span class="helper">No absences</span>
                                                <% } %>
                                            </td>
                                        </tr>
                                    <% }); %>
                                </tbody>
                            </table>
                        </div>

                        <!-- GRADES VIEW -->
                        <div class="view-content" data-view="grades" data-subject="<%= subject %>">
                            <h3>Add Grades - <%= subject %></h3>
                            
                            <div class="bulk-actions" style="margin-bottom: 20px;">
                                <div style="display: flex; flex-direction: column; gap: 10px; width: 100%;">
                                    <label style="font-weight: 600; display: flex; align-items: center; gap: 10px; justify-content: space-between; flex-wrap: wrap;">
                                        <span><strong>Date:</strong></span>
                                        <!-- Hidden input that actually stores the selected date -->
                                        <input type="hidden" 
                                               id="grade-date-<%= subject %>" 
                                               value="<%= new Date().toISOString().split('T')[0] %>">
                                        <!-- Mini calendar container -->
                                        <div id="grade-calendar-<%= subject %>" class="mini-calendar"></div>
                                    </label>
                                </div>
                            </div>

                            <table>
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Current Grades</th>
                                        <th>Average</th>
                                        <th>New Grade</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% students.forEach(function(student) { 
                                        const allGrades = student.allGrades || [];
                                        const subjectGrades = allGrades.filter(g => g.subject === subject);
                                        const average = subjectGrades.length > 0 
                                            ? (subjectGrades.reduce((sum, g) => sum + g.grade, 0) / subjectGrades.length).toFixed(2)
                                            : 'N/A';
                                    %>
                                        <tr>
                                            <td><strong><%= student.name %></strong></td>
                                            <td><%= student.email %></td>
                                            <td>
                                                <% if (subjectGrades.length > 0) { %>
                                                    <% subjectGrades.slice(0, 10).forEach(function(grade) { %>
                                                        <span class="grade-badge"><%= grade.grade %></span>
                                                    <% }); %>
                                                    <% if (subjectGrades.length > 10) { %>
                                                        <span class="helper">+<%= subjectGrades.length - 10 %></span>
                                                    <% } %>
                                                <% } else { %>
                                                    <span class="helper">No grades yet</span>
                                                <% } %>
                                            </td>
                                            <td><strong><%= average %></strong></td>
                                            <td>
                                                <select class="student-grade-select" 
                                                        data-subject="<%= subject %>"
                                                        data-student-id="<%= student.uid %>"
                                                        data-student-name="<%= student.name %>"
                                                        style="padding: 6px 10px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-secondary); color: var(--text-primary); min-width: 150px;">
                                                    <option value="">-- Select Grade --</option>
                                                    <option value="10">10 - Excellent</option>
                                                    <option value="9">9 - Very Good</option>
                                                    <option value="8">8 - Good</option>
                                                    <option value="7">7 - Satisfactory</option>
                                                    <option value="6">6 - Sufficient</option>
                                                    <option value="5">5 - Insufficient</option>
                                                    <option value="4">4 - Insufficient</option>
                                                    <option value="3">3 - Insufficient</option>
                                                    <option value="2">2 - Insufficient</option>
                                                    <option value="1">1 - Insufficient</option>
                                                </select>
                                            </td>
                                        </tr>
                                    <% }); %>
                                </tbody>
                            </table>
                            
                            <div style="margin-top: 20px; display: flex; justify-content: flex-end;">
                                <button type="button" 
                                        class="btn-primary" 
                                        id="save-grades-btn-<%= subject %>"
                                        onclick="saveAllGrades('<%= subject %>', '<%= classYear %>')"
                                        style="padding: 12px 24px; font-size: 16px; font-weight: 600;">
                                    üíæ Save All Grades
                                </button>
                            </div>
                        </div>

                        <!-- ABSENCES VIEW -->
                        <div class="view-content" data-view="absences" data-subject="<%= subject %>">
                            <h3>Take Attendance - <%= subject %></h3>
                            
                            <div class="bulk-actions" style="margin-bottom: 20px;">
                                <div style="display: flex; flex-direction: column; gap: 10px; width: 100%;">
                                    <label style="font-weight: 600; display: flex; align-items: center; gap: 10px; justify-content: space-between; flex-wrap: wrap;">
                                        <span><strong>Date:</strong></span>
                                        <!-- Hidden input that actually stores the selected date -->
                                        <input type="hidden" 
                                               id="absence-date-<%= subject %>" 
                                               value="<%= new Date().toISOString().split('T')[0] %>">
                                        <!-- Mini calendar container -->
                                        <div id="absence-calendar-<%= subject %>" class="mini-calendar"></div>
                                    </label>
                                </div>
                            </div>
                            
                            <table>
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Attendance</th>
                                        <th>Recent Absences</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% students.forEach(function(student) { 
                                        const allAbsences = student.allAbsences || [];
                                        const subjectAbsences = allAbsences.filter(a => a.subject === subject);
                                    %>
                                        <tr>
                                            <td><strong><%= student.name %></strong></td>
                                            <td><%= student.email %></td>
                                            <td>
                                                <button type="button" 
                                                        class="presence-btn present" 
                                                        id="presence-<%= student.uid %>-<%= subject %>"
                                                        data-student-id="<%= student.uid %>"
                                                        data-student-name="<%= student.name %>"
                                                        onclick="toggleAbsent('<%= student.uid %>', '<%= subject %>')">
                                                    ‚úì Present
                                                </button>
                                            </td>
                                            <td>
                                                <% if (subjectAbsences.length > 0) { %>
                                                    Total: <strong><%= subjectAbsences.length %></strong> absences<br>
                                                    <% subjectAbsences.slice(0, 5).forEach(function(absence) { 
                                                        let dateStr = '';
                                                        if (absence.date && absence.date.toDate) {
                                                            dateStr = absence.date.toDate().toLocaleDateString();
                                                        } else if (absence.date) {
                                                            dateStr = new Date(absence.date).toLocaleDateString();
                                                        }
                                                    %>
                                                        <span class="absence-badge <%= absence.type === 'motivated' ? 'motivated' : 'unmotivated' %>">
                                                            <%= dateStr %>
                                                        </span>
                                                    <% }); %>
                                                <% } else { %>
                                                    <span class="helper">No absences</span>
                                                <% } %>
                                            </td>
                                        </tr>
                                    <% }); %>
                                </tbody>
                            </table>
                            
                            <div style="margin-top: 20px; display: flex; justify-content: flex-end;">
                                <button type="button" 
                                        class="btn-primary" 
                                        id="save-absences-btn-<%= subject %>"
                                        onclick="saveAllAbsences('<%= subject %>', '<%= classYear %>')"
                                        style="padding: 12px 24px; font-size: 16px; font-weight: 600;">
                                    üíæ Save All Absences
                                </button>
                            </div>
                        </div>
                    </div>
                <% }); %>
            <% } %>
        </div>

        <div class="dashboard-footer">
            <form action="/auth/logout" method="GET">
                <button type="submit" class="btn-primary">Logout</button>
            </form>
        </div>
    </div>

    <script>
        // Simple mini calendar component (no weird -1 month bug)
        // Simple working calendar - completely rewritten
        const calendarStates = {}; // Store state per calendar instance
        
        function initMiniCalendar(containerId, hiddenInputId) {
            const container = document.getElementById(containerId);
            const hiddenInput = document.getElementById(hiddenInputId);
            if (!container || !hiddenInput) return;

            // Initialize state for this calendar only once
            if (!calendarStates[containerId]) {
                const today = new Date();
                const initialDate = hiddenInput.value ? new Date(hiddenInput.value + 'T00:00:00') : today;
                
                calendarStates[containerId] = {
                    year: initialDate.getFullYear(),
                    month: initialDate.getMonth(),
                    selectedDate: hiddenInput.value || `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`
                };
                // Ensure hidden input has a value
                if (!hiddenInput.value) {
                    hiddenInput.value = calendarStates[containerId].selectedDate;
                }
            } else {
                // Keep selectedDate in sync if it was changed externally
                if (hiddenInput.value) {
                    calendarStates[containerId].selectedDate = hiddenInput.value;
                }
            }

            function renderCalendar() {
                const state = calendarStates[containerId];
                const { year, month } = state;
                
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                                    'July', 'August', 'September', 'October', 'November', 'December'];
                const dayNames = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
                
                // Get first day of month and number of days
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const prevMonthDays = new Date(year, month, 0).getDate();
                
                let html = `
                    <div class="mini-calendar-header">
                        <button type="button" class="cal-nav-btn" data-cal="${containerId}" data-dir="-1">&lt;</button>
                        <span>${monthNames[month]} ${year}</span>
                        <button type="button" class="cal-nav-btn" data-cal="${containerId}" data-dir="1">&gt;</button>
                    </div>
                    <div class="mini-calendar-grid">
                `;
                
                // Day headers
                dayNames.forEach(day => {
                    html += `<div class="mini-calendar-day-header">${day}</div>`;
                });
                
                // Previous month days
                for (let i = firstDay - 1; i >= 0; i--) {
                    html += `<div class="mini-calendar-day other-month">${prevMonthDays - i}</div>`;
                }
                
                // Current month days
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const isSelected = dateStr === state.selectedDate;
                    html += `<div class="mini-calendar-day${isSelected ? ' selected' : ''}" data-cal="${containerId}" data-date="${dateStr}">${day}</div>`;
                }
                
                // Next month days to fill grid
                const totalCells = firstDay + daysInMonth;
                const remainingCells = totalCells % 7 === 0 ? 0 : 7 - (totalCells % 7);
                for (let i = 1; i <= remainingCells; i++) {
                    html += `<div class="mini-calendar-day other-month">${i}</div>`;
                }
                
                html += '</div>';
                container.innerHTML = html;
            }

            renderCalendar();
        }
        
        // Global event delegation for all calendars
        document.addEventListener('click', function(e) {
            // Handle navigation buttons
            if (e.target.classList.contains('cal-nav-btn')) {
                e.preventDefault();
                const calId = e.target.getAttribute('data-cal');
                const dir = parseInt(e.target.getAttribute('data-dir'));
                const state = calendarStates[calId];
                
                if (state) {
                    state.month += dir;
                    if (state.month > 11) {
                        state.month = 0;
                        state.year++;
                    } else if (state.month < 0) {
                        state.month = 11;
                        state.year--;
                    }
                    
                    const container = document.getElementById(calId);
                    if (container) {
                        initMiniCalendar(calId, calId.replace('-calendar-', '-date-'));
                    }
                }
            }
            
            // Handle day selection
            if (e.target.classList.contains('mini-calendar-day') && e.target.getAttribute('data-date')) {
                e.preventDefault();
                const calId = e.target.getAttribute('data-cal');
                const dateStr = e.target.getAttribute('data-date');
                const hiddenInputId = calId.replace('-calendar-', '-date-');
                const hiddenInput = document.getElementById(hiddenInputId);
                
                if (hiddenInput && calendarStates[calId]) {
                    hiddenInput.value = dateStr;
                    calendarStates[calId].selectedDate = dateStr;
                    
                    const container = document.getElementById(calId);
                    if (container) {
                        initMiniCalendar(calId, hiddenInputId);
                    }
                }
            }
        });

        // Switch between subjects
        function switchSubject(subject) {
            document.querySelectorAll('.subject-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.subject-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`.subject-tab:nth-child(${Array.from(document.querySelectorAll('.subject-tab')).findIndex(t => t.textContent.trim() === subject) + 1})`).classList.add('active');
            document.querySelector(`.subject-content[data-subject="${subject}"]`).classList.add('active');
        }

        // Switch between views (Overview, Grades, Absences)
        function switchView(subject, view) {
            const subjectContent = document.querySelector(`.subject-content[data-subject="${subject}"]`);
            subjectContent.querySelectorAll('.view-tab').forEach(tab => tab.classList.remove('active'));
            subjectContent.querySelectorAll('.view-content').forEach(content => content.classList.remove('active'));
            
            const tabs = Array.from(subjectContent.querySelectorAll('.view-tab'));
            const viewIndex = view === 'overview' ? 0 : view === 'grades' ? 1 : 2;
            tabs[viewIndex].classList.add('active');
            
            subjectContent.querySelector(`.view-content[data-view="${view}"]`).classList.add('active');

            // Initialize calendar when switching to grades or absences (first time only)
            if (view === 'grades') {
                const calId = `grade-calendar-${subject}`;
                if (!calendarStates[calId]) {
                    initMiniCalendar(calId, `grade-date-${subject}`);
                }
            } else if (view === 'absences') {
                const calId = `absence-calendar-${subject}`;
                if (!calendarStates[calId]) {
                    initMiniCalendar(calId, `absence-date-${subject}`);
                }
            }
        }

        // Toggle select all checkboxes (for absences)
        function toggleSelectAll(subject, type) {
            const selectAll = document.getElementById(`select-all-${type}-${subject}`);
            if (!selectAll) return;
            
            const checkboxes = document.querySelectorAll(`.student-checkbox-${type}[data-subject="${subject}"]`);
            
            checkboxes.forEach(cb => {
                cb.checked = selectAll.checked;
            });
        }

        // Save all grades with selected date - using fetch for speed
        async function saveAllGrades(subject, classYear) {
            const dateInput = document.getElementById(`grade-date-${subject}`);
            const date = dateInput ? dateInput.value : new Date().toISOString().split('T')[0];
            
            if (!date) {
                alert('Please select a date for the grades');
                return;
            }
            
            // Collect all grades
            const gradeSelects = document.querySelectorAll(`.student-grade-select[data-subject="${subject}"]`);
            const grades = [];
            
            gradeSelects.forEach(select => {
                const grade = select.value;
                if (grade) {
                    grades.push({
                        studentId: select.getAttribute('data-student-id'),
                        studentName: select.getAttribute('data-student-name'),
                        grade: grade
                    });
                }
            });
            
            if (grades.length === 0) {
                alert('Please select at least one grade to save');
                return;
            }
            
            // Show confirmation
            const gradeList = grades.map(g => `${g.studentName}: ${g.grade}`).join('\n');
            if (!confirm(`Save ${grades.length} grade(s) for ${date}?\n\n${gradeList}`)) {
                return;
            }
            
            // Show loading indicator
            const saveBtn = document.getElementById(`save-grades-btn-${subject}`);
            const originalText = saveBtn.textContent;
            saveBtn.disabled = true;
            saveBtn.textContent = '‚è≥ Saving...';
            
            try {
                // Submit grades via fetch (no page reload!)
                const response = await fetch('/add-grades-bulk', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        grades: grades,
                        subject: subject,
                        classYear: classYear,
                        date: date
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Clear the grade selects
                    gradeSelects.forEach(select => {
                        if (select.value) {
                            select.value = '';
                        }
                    });
                    
                    // Show success message
                    alert('‚úì ' + data.message);
                    
                    // Refresh the page to show updated grades
                    window.location.reload();
                } else {
                    alert('Error: ' + data.error);
                    saveBtn.disabled = false;
                    saveBtn.textContent = originalText;
                }
            } catch (error) {
                console.error('Error saving grades:', error);
                alert('Failed to save grades. Please try again.');
                saveBtn.disabled = false;
                saveBtn.textContent = originalText;
            }
        }

        // Toggle student absent status (visual only, doesn't save)
        function toggleAbsent(studentId, subject) {
            const button = document.getElementById(`presence-${studentId}-${subject}`);
            
            if (button.classList.contains('present')) {
                // Mark as absent (visual only)
                button.classList.remove('present');
                button.classList.add('absent');
                button.textContent = '‚úó Absent';
            } else {
                // Mark as present (visual only)
                button.classList.remove('absent');
                button.classList.add('present');
                button.textContent = '‚úì Present';
            }
        }

        // Save all absences with selected date
        async function saveAllAbsences(subject, classYear) {
            const dateInput = document.getElementById(`absence-date-${subject}`);
            const date = dateInput ? dateInput.value : new Date().toISOString().split('T')[0];
            
            if (!date) {
                alert('Please select a date for the absences');
                return;
            }
            
            // Collect all students marked as absent
            const allButtons = document.querySelectorAll(`button[id^="presence-"][id$="-${subject}"]`);
            const absences = [];
            
            allButtons.forEach(button => {
                if (button.classList.contains('absent')) {
                    const studentId = button.getAttribute('data-student-id');
                    const studentName = button.getAttribute('data-student-name');
                    if (studentId && studentName) {
                        absences.push({
                            studentId: studentId,
                            studentName: studentName,
                            type: 'unmotivated',
                            reason: ''
                        });
                    }
                }
            });
            
            if (absences.length === 0) {
                alert('Please mark at least one student as absent');
                return;
            }
            
            // Show confirmation
            const studentNames = absences.map(a => a.studentName).join(', ');
            const dateObj = new Date(date);
            const dateStr = dateObj.toLocaleDateString();
            if (!confirm(`Save ${absences.length} absence(s) for ${dateStr}?\n\nStudents: ${studentNames}`)) {
                return;
            }
            
            // Show loading indicator
            const saveBtn = document.getElementById(`save-absences-btn-${subject}`);
            const originalText = saveBtn.textContent;
            saveBtn.disabled = true;
            saveBtn.textContent = '‚è≥ Saving...';
            
            try {
                // Submit absences via fetch (no page reload!)
                const response = await fetch('/add-absences-bulk', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        absences: absences,
                        subject: subject,
                        classYear: classYear,
                        date: date
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Reset all buttons to present state
                    allButtons.forEach(button => {
                        button.classList.remove('absent');
                        button.classList.add('present');
                        button.textContent = '‚úì Present';
                    });
                    
                    // Show success message
                    alert('‚úì ' + data.message);
                    
                    // Refresh the page to show updated absences
                    window.location.reload();
                } else {
                    alert('Error: ' + data.error);
                    saveBtn.disabled = false;
                    saveBtn.textContent = originalText;
                }
            } catch (error) {
                console.error('Error saving absences:', error);
                alert('Failed to save absences. Please try again.');
                saveBtn.disabled = false;
                saveBtn.textContent = originalText;
            }
        }

        // Initialize calendars for the first visible subject on page load
        document.addEventListener('DOMContentLoaded', () => {
            const firstSubjectContent = document.querySelector('.subject-content.active');
            if (firstSubjectContent) {
                const subject = firstSubjectContent.getAttribute('data-subject');
                if (subject) {
                    initMiniCalendar(`grade-calendar-${subject}`, `grade-date-${subject}`);
                    initMiniCalendar(`absence-calendar-${subject}`, `absence-date-${subject}`);
                }
            }
        });
    </script>
</body>
</html>
