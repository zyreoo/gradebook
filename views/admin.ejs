<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Online Gradebook</title>
    <link rel="stylesheet" href="/styles.css">
    <style>
        :root {
            --bg: #0c0c0c;
            --panel: #0f0f10;
            --muted: #131313;
            --border: #1a1a1d;
            --text: #f5f5f5;
            --text-dim: #9ca3af;
            --accent: #e5e5e5;
            --accent-hover: #d4d4d8;
            --error: #ef4444;
            --success: #22c55e;
            --shadow: 0 14px 36px rgba(0, 0, 0, 0.45);
            --shadow-soft: 0 6px 18px rgba(0, 0, 0, 0.35);
            --radius-lg: 18px;
            --radius-md: 12px;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background:
                radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.05), transparent 42%),
                radial-gradient(circle at 80% 0%, rgba(255, 255, 255, 0.04), transparent 38%),
                var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            padding: 32px 16px 60px;
        }

        .page-shell {
            max-width: 1200px;
            margin: 0 auto;
        }

        .top-bar {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 22px 24px;
            box-shadow: var(--shadow-soft);
            display: flex;
            justify-content: space-between;
            gap: 16px;
            align-items: center;
        }

        .brand {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .brand-mark {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: linear-gradient(145deg, #1c1c1e, #2a2a2d);
            color: #fff;
            display: grid;
            place-items: center;
            font-weight: 800;
            letter-spacing: -0.03em;
            box-shadow: var(--shadow-soft);
        }

        .brand h1 {
            margin: 0;
            font-size: 22px;
            letter-spacing: -0.02em;
        }

        .brand p {
            margin: 2px 0 0;
            color: var(--text-dim);
            font-size: 14px;
        }

        .user-chip {
            background: var(--muted);
            border: 1px solid var(--border);
            border-radius: 999px;
            padding: 10px 14px;
            font-size: 14px;
            color: var(--text);
            box-shadow: var(--shadow-soft);
        }

        .logout-btn {
            text-decoration: none;
            color: var(--text);
            font-weight: 600;
            padding: 10px 14px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: var(--muted);
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            background: var(--accent);
            color: #0b0b0b;
            border-color: var(--accent);
            box-shadow: var(--shadow-soft);
        }

        .hero {
            margin-top: 18px;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 22px 24px;
            box-shadow: var(--shadow-soft);
        }

        .hero p {
            margin: 0 0 14px;
            color: var(--text-dim);
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 14px;
        }

        .stat {
            padding: 16px 18px;
            border-radius: 14px;
            background: var(--panel);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-soft);
        }

        .stat h3 {
            margin: 0 0 6px;
            font-size: 13px;
            letter-spacing: 0.02em;
            text-transform: uppercase;
            color: var(--text-dim);
        }

        .stat .number {
            font-size: 32px;
            font-weight: 700;
            color: var(--accent);
            letter-spacing: -0.02em;
        }

        .section-nav {
            margin: 22px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .section-nav a {
            text-decoration: none;
            color: var(--text);
            background: var(--muted);
            padding: 10px 14px;
            border-radius: 12px;
            border: 1px solid var(--border);
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .section-nav a:hover {
            background: var(--panel);
            box-shadow: var(--shadow-soft);
            color: var(--accent);
        }

        .section {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 26px 24px;
            box-shadow: var(--shadow);
            margin-bottom: 18px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 18px;
        }

        .section-header h2 {
            margin: 0;
            font-size: 18px;
            letter-spacing: -0.01em;
        }

        .section-header p {
            margin: 6px 0 0;
            color: var(--text-dim);
            font-size: 14px;
        }

        .pill-rail {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 14px;
            border: 1px dashed var(--border);
            border-radius: 14px;
            background: var(--muted);
            min-height: 64px;
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 999px;
            background: var(--panel);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-soft);
            font-weight: 600;
            font-size: 14px;
            color: var(--text);
        }

        .pill button {
            border: none;
            background: transparent;
            color: var(--text-dim);
            cursor: pointer;
            font-size: 15px;
            padding: 2px 4px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .pill button:hover {
            background: var(--error);
            color: #fff;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
        }

        .field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-weight: 600;
            font-size: 14px;
            color: var(--text);
        }

        input, select {
            padding: 12px 14px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--muted);
            font-size: 14px;
            color: var(--text);
            transition: all 0.2s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.12);
            background: var(--panel);
        }

        .primary-btn {
            background: var(--accent);
            color: #0c0c0c;
            border: none;
            border-radius: 12px;
            padding: 12px 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-soft);
        }

        .primary-btn:hover { background: var(--accent-hover); }

        .helper {
            color: var(--text-dim);
            font-size: 13px;
            margin: 0;
        }

        .grid-two {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 16px;
        }

        .people-list {
            display: grid;
            gap: 12px;
        }

        .person {
            padding: 16px;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            display: flex;
            justify-content: space-between;
            gap: 12px;
            align-items: center;
            box-shadow: var(--shadow-soft);
        }

        .person strong { display: block; }
        .person small { color: var(--text-dim); }

        .filter {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 6px 10px;
            border-radius: 10px;
            background: var(--panel);
            border: 1px solid var(--border);
            font-size: 13px;
            color: var(--text-dim);
        }

        .muted-box {
            padding: 18px;
            border-radius: var(--radius-md);
            background: var(--muted);
            border: 1px dashed var(--border);
            color: var(--text-dim);
            text-align: center;
        }

        .message {
            padding: 14px 16px;
            border-radius: 12px;
            border: 1px solid;
            margin: 16px 0;
        }
        .message.error { border-color: rgba(217, 83, 79, 0.35); background: rgba(217, 83, 79, 0.1); color: var(--error); }
        .message.success { border-color: rgba(47, 155, 98, 0.35); background: rgba(47, 155, 98, 0.1); color: var(--success); }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.55);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 16px;
            backdrop-filter: blur(3px);
        }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--panel);
            border: 1px solid var(--border);
            padding: 22px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            max-width: 460px;
            width: 100%;
        }
        .modal h3 { margin-top: 0; margin-bottom: 10px; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; }
        .ghost-btn {
            background: var(--muted);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 10px 14px;
            border-radius: 10px;
            cursor: pointer;
        }
        .danger-btn {
            background: var(--error);
            color: #fff;
            border: none;
            padding: 10px 14px;
            border-radius: 10px;
            cursor: pointer;
        }

        @media (max-width: 720px) {
            .top-bar, .section-header { flex-direction: column; align-items: flex-start; }
            .brand { width: 100%; }
            .section-nav { gap: 8px; }
        }
    </style>
</head>
<body>
    <div class="page-shell">
        <div class="top-bar">
            <div class="brand">
                <div class="brand-mark">GB</div>
                <div>
                    <h1><%= school.name %></h1>
                    <% if (typeof user !== 'undefined' && user) { %>
                        <p>Welcome back, <strong><%= user.name %></strong></p>
                    <% } %>
                </div>
            </div>
            <div style="display:flex; gap:10px; align-items:center;">
                <div class="user-chip"><%= user && user.email ? user.email : 'Admin' %></div>
                <a class="logout-btn" href="/auth/logout">Logout</a>
            </div>
        </div>

        <div class="hero">
            <p>A calmer, clearer workspace for your school.</p>
            <div class="stat-grid">
                <div class="stat">
                    <h3>Teachers</h3>
                    <div class="number"><%= teachers.length %></div>
                </div>
                <div class="stat">
                    <h3>Students</h3>
                    <div class="number"><%= students.length %></div>
                </div>
                <div class="stat">
                    <h3>Subjects</h3>
                    <div class="number"><%= (school.subjects || []).length %></div>
                </div>
            </div>
        </div>

        <% if (typeof error !== 'undefined' && error) { %>
            <div class="message error"><%= error %></div>
        <% } %>
        <% if (typeof success !== 'undefined' && success) { %>
            <div class="message success"><%= success %></div>
        <% } %>

        <div class="section-nav">
            <a href="#subjects">Subjects</a>
            <a href="#grades">Grade availability</a>
            <a href="#add-user">Add user</a>
            <a href="#people">People</a>
        </div>

        <section id="subjects" class="section">
            <div class="section-header">
                <div>
                    <h2>Subject library</h2>
                    <p>Keep your catalog tidy. Remove unused subjects or add new ones.</p>
                </div>
            </div>

            <% if (school.subjects && school.subjects.length > 0) { %>
                <div class="pill-rail">
                    <% school.subjects.forEach(function(subject) { %>
                        <div class="pill">
                            <span><%= subject %></span>
                            <button type="button" onclick="confirmRemoveSubject('<%= subject %>')" aria-label="Remove <%= subject %>">×</button>
                        </div>
                    <% }); %>
                </div>
            <% } else { %>
                <div class="muted-box">No subjects yet. Add your first one below.</div>
            <% } %>

            <form action="/admin/add-subject" method="POST" onsubmit="return validateSubjectForm()" style="margin-top:18px;">
                <div class="form-grid">
                    <div class="field">
                        <label for="subjectName">Add a subject</label>
                        <input id="subjectName" name="subjectName" type="text" placeholder="e.g., Mathematics, Chemistry" maxlength="50" required>
                    </div>
                    <div class="field" style="align-self:flex-end;">
                        <button class="primary-btn" type="submit">Add subject</button>
                    </div>
                </div>
            </form>
        </section>

        <section id="grades" class="section">
            <div class="section-header">
                <div>
                    <h2>Grade availability</h2>
                    <p>Choose which subjects each grade level can access.</p>
                </div>
            </div>

            <% const classYears = ['9', '10', '11', '12']; %>
            <% const classYearSubjects = school.classYearSubjects || {}; %>
            <div class="grid-two">
                <% classYears.forEach(function(year) { %>
                    <div class="muted-box" style="text-align:left; padding:16px; border-style:solid; border-radius:var(--radius-md);">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <strong>Grade <%= year %></strong>
                            <span class="badge"><%= (classYearSubjects[year] || []).length %> assigned</span>
                        </div>

                        <% if (classYearSubjects[year] && classYearSubjects[year].length > 0) { %>
                            <div class="pill-rail" style="border-style:solid; margin-bottom:12px;">
                                <% classYearSubjects[year].forEach(function(subject) { %>
                                    <div class="pill">
                                        <span><%= subject %></span>
                                        <form action="/admin/remove-subject-from-class" method="POST" style="margin:0;">
                                            <input type="hidden" name="classYear" value="<%= year %>">
                                            <input type="hidden" name="subjectName" value="<%= subject %>">
                                            <button type="submit" aria-label="Remove subject">×</button>
                                        </form>
                                    </div>
                                <% }); %>
                            </div>
                        <% } else { %>
                            <p class="helper" style="margin-bottom:12px;">No subjects assigned yet.</p>
                        <% } %>

                        <form action="/admin/add-subject-to-class" method="POST">
                            <input type="hidden" name="classYear" value="<%= year %>">
                            <div class="form-grid" style="grid-template-columns: 1fr auto;">
                                <div class="field" style="margin:0;">
                                    <label for="subjectName-<%= year %>">Add subject</label>
                                    <select id="subjectName-<%= year %>" name="subjectName" required>
                                        <option value="">Choose</option>
                                        <% if (school.subjects && school.subjects.length > 0) { %>
                                            <% school.subjects.forEach(function(subject) { %>
                                                <% if (!classYearSubjects[year] || !classYearSubjects[year].includes(subject)) { %>
                                                    <option value="<%= subject %>"><%= subject %></option>
                                                <% } %>
                                            <% }); %>
                                        <% } %>
                                    </select>
                                </div>
                                <div class="field" style="margin:0; align-self:flex-end;">
                                    <button class="primary-btn" type="submit">Add</button>
                                </div>
                            </div>
                        </form>
                    </div>
                <% }); %>
            </div>
        </section>

        <section id="add-user" class="section">
            <div class="section-header">
                <div>
                    <h2>Create a user</h2>
                    <p>Add teachers or students and set the right fields in one pass.</p>
                </div>
            </div>
            <form action="/admin/create-user" method="POST">
                <div class="form-grid">
                    <div class="field">
                        <label for="name">Full name</label>
                        <input id="name" name="name" type="text" placeholder="Jane Smith" autocomplete="name" required>
                    </div>
                    <div class="field">
                        <label for="email">Email</label>
                        <input id="email" name="email" type="email" placeholder="jane.smith@school.edu" autocomplete="email" required>
                    </div>
                    <div class="field">
                        <label for="password">Password</label>
                        <input id="password" name="password" type="password" minlength="6" placeholder="Minimum 6 characters" autocomplete="new-password" required>
                    </div>
                    <div class="field">
                        <label for="confirmPassword">Confirm password</label>
                        <input id="confirmPassword" name="confirmPassword" type="password" minlength="6" placeholder="Re-enter password" autocomplete="new-password" required>
                    </div>
                    <div class="field">
                        <label for="role">Role</label>
                        <select id="role" name="role" required>
                            <option value="">Select role</option>
                            <option value="student">Student</option>
                            <option value="teacher">Teacher</option>
                        </select>
                    </div>
                    <div class="field" id="classYearGroup" style="display:none;">
                        <label for="classYear">Grade level</label>
                        <select id="classYear" name="classYear">
                            <option value="">Select grade</option>
                            <option value="9">9th Grade</option>
                            <option value="10">10th Grade</option>
                            <option value="11">11th Grade</option>
                            <option value="12">12th Grade</option>
                        </select>
                    </div>
                    <div class="field" id="subjectGroup" style="display:none;">
                        <label for="subject">Subject (optional)</label>
                        <select id="subject" name="subject">
                            <option value="">Select subject (optional)</option>
                            <% if (school.subjects && school.subjects.length > 0) { %>
                                <% school.subjects.forEach(function(subject) { %>
                                    <option value="<%= subject %>"><%= subject %></option>
                                <% }); %>
                            <% } %>
                        </select>
                    </div>
                </div>
                <div style="margin-top:14px;">
                    <button class="primary-btn" type="submit">Create user</button>
                </div>
            </form>
        </section>

        <section id="people" class="section">
            <div class="section-header">
                <div>
                    <h2>People</h2>
                    <p>Filter and skim your teachers and students.</p>
                </div>
            </div>

            <div class="grid-two">
                <div>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                        <strong>Teachers</strong>
                        <span class="badge" id="teacher-count"><%= teachers.length %></span>
                    </div>
                    <% if (teachers.length > 0) { %>
                        <div class="filter">
                            <label for="subject-filter">Filter by subject</label>
                            <select id="subject-filter" onchange="filterTeachers()">
                                <option value="all">All</option>
                                <% if (school.subjects && school.subjects.length > 0) { %>
                                    <% school.subjects.forEach(function(subject) { %>
                                        <option value="<%= subject %>"><%= subject %></option>
                                    <% }); %>
                                <% } %>
                                <option value="none">No subject</option>
                            </select>
                        </div>
                        <div class="people-list" id="teachers-grid">
                            <% teachers.forEach(function(t) { %>
                                <div class="person teacher-item" data-subject="<%= t.subject || 'none' %>">
                                    <div>
                                        <strong><%= t.name %></strong>
                                        <small><%= t.email %></small><br>
                                        <% if (t.subject) { %><small><%= t.subject %></small><% } %>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                        <p id="no-teachers-filtered" class="helper" style="display:none; margin-top:10px;">No teachers match this filter.</p>
                    <% } else { %>
                        <div class="muted-box">No teachers yet.</div>
                    <% } %>
                </div>

                <div>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                        <strong>Students</strong>
                        <span class="badge" id="student-count"><%= students.length %></span>
                    </div>
                    <% if (students.length > 0) { %>
                        <div class="filter">
                            <label for="class-filter">Filter by grade</label>
                            <select id="class-filter" onchange="filterStudents()">
                                <option value="all">All</option>
                                <option value="9">9th Grade</option>
                                <option value="10">10th Grade</option>
                                <option value="11">11th Grade</option>
                                <option value="12">12th Grade</option>
                                <option value="none">No grade</option>
                            </select>
                        </div>
                        <div class="people-list" id="students-grid">
                            <% students.forEach(function(s) { %>
                                <div class="person student-item" data-classyear="<%= s.classYear || 'none' %>">
                                    <div>
                                        <strong><%= s.name %></strong>
                                        <small><%= s.email %></small><br>
                                        <% if (s.classYear) { %><small>Grade <%= s.classYear %></small><% } %>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                        <p id="no-students-filtered" class="helper" style="display:none; margin-top:10px;">No students match this filter.</p>
                    <% } else { %>
                        <div class="muted-box">No students yet.</div>
                    <% } %>
                </div>
            </div>
        </section>
    </div>

    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3>Confirm subject deletion</h3>
            <p id="modal-message"></p>
            <div class="modal-actions">
                <button class="ghost-btn" type="button" onclick="closeModal()">Cancel</button>
                <button class="danger-btn" type="button" onclick="deleteSubject()">Delete subject</button>
            </div>
        </div>
    </div>

    <script type="application/json" id="school-subjects-data">
        <%- JSON.stringify(school.subjects || []) %>
    </script>
    <script>
        let subjectToDelete = null;
        const schoolSubjects = JSON.parse(document.getElementById('school-subjects-data').textContent);

        function validateSubjectForm() {
            const subjectName = document.getElementById('subjectName').value.trim();
            if (!subjectName) { alert('Please enter a subject name'); return false; }
            if (schoolSubjects.some(s => s.toLowerCase() === subjectName.toLowerCase())) {
                alert('This subject already exists');
                return false;
            }
            return true;
        }

        async function confirmRemoveSubject(subjectName) {
            subjectToDelete = subjectName;
            try {
                const response = await fetch('/admin/check-subject-usage', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ subjectName })
                });
                const data = await response.json();
                const message = document.getElementById('modal-message');
                if (data.inUse && data.count > 0) {
                    message.innerHTML = `Warning: This subject is currently assigned to <strong>${data.count} teacher(s)</strong>. Deleting it will not affect existing teacher assignments, but the subject will no longer be available for new assignments.<br><br>Are you sure you want to delete "<strong>${subjectName}</strong>"?`;
                } else {
                    message.innerHTML = `Are you sure you want to delete "<strong>${subjectName}</strong>"?`;
                }
                document.getElementById('deleteModal').classList.add('active');
            } catch (err) {
                console.error('Error checking subject usage:', err);
                alert('Error checking subject usage. Please try again.');
            }
        }

        function closeModal() {
            document.getElementById('deleteModal').classList.remove('active');
            subjectToDelete = null;
        }

        function deleteSubject() {
            if (!subjectToDelete) return;
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/admin/remove-subject';
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'subjectName';
            input.value = subjectToDelete;
            form.appendChild(input);
            document.body.appendChild(form);
            form.submit();
        }

        window.addEventListener('click', (e) => {
            const modal = document.getElementById('deleteModal');
            if (e.target === modal) closeModal();
        });

        function toggleRoleFields() {
            const role = document.getElementById('role').value;
            const classYearGroup = document.getElementById('classYearGroup');
            const classYearSelect = document.getElementById('classYear');
            const subjectGroup = document.getElementById('subjectGroup');
            const subjectSelect = document.getElementById('subject');

            if (role === 'student') {
                classYearGroup.style.display = 'block';
                classYearSelect.required = true;
                subjectGroup.style.display = 'none';
                subjectSelect.required = false;
                subjectSelect.value = '';
            } else if (role === 'teacher') {
                classYearGroup.style.display = 'none';
                classYearSelect.required = false;
                classYearSelect.value = '';
                subjectGroup.style.display = 'block';
                subjectSelect.required = false;
            } else {
                classYearGroup.style.display = 'none';
                classYearSelect.required = false;
                classYearSelect.value = '';
                subjectGroup.style.display = 'none';
                subjectSelect.required = false;
                subjectSelect.value = '';
            }
        }

        function filterTeachers() {
            const selected = document.getElementById('subject-filter').value;
            const items = document.querySelectorAll('.teacher-item');
            const msg = document.getElementById('no-teachers-filtered');
            const count = document.getElementById('teacher-count');
            let visible = 0;
            items.forEach(item => {
                const subject = item.getAttribute('data-subject');
                if (selected === 'all' || subject === selected) {
                    item.style.display = 'flex';
                    visible++;
                } else {
                    item.style.display = 'none';
                }
            });
            count.textContent = visible;
            msg.style.display = visible === 0 ? 'block' : 'none';
        }

        function filterStudents() {
            const selected = document.getElementById('class-filter').value;
            const items = document.querySelectorAll('.student-item');
            const msg = document.getElementById('no-students-filtered');
            const count = document.getElementById('student-count');
            let visible = 0;
            items.forEach(item => {
                const year = item.getAttribute('data-classyear');
                if (selected === 'all' || year === selected) {
                    item.style.display = 'flex';
                    visible++;
                } else {
                    item.style.display = 'none';
                }
            });
            count.textContent = visible;
            msg.style.display = visible === 0 ? 'block' : 'none';
        }

        document.addEventListener('DOMContentLoaded', () => {
            const roleSelect = document.getElementById('role');
            if (roleSelect) {
                roleSelect.addEventListener('change', toggleRoleFields);
                toggleRoleFields();
            }
        });
    </script>
</body>
</html>
